<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chord Lab - Master Chord Progressions</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            color: white;
            padding: 20px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 0;
        }

        .sidebar {
            background: #f8f9fa;
            border-right: 1px solid #e9ecef;
            padding: 30px 25px;
            overflow-y: auto;
        }

        .workspace {
            padding: 30px;
            overflow-y: auto;
        }

        .section {
            margin-bottom: 30px;
        }

        .section h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 5px;
        }

        .key-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .key-btn {
            padding: 12px 8px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
            text-align: center;
            font-size: 0.9rem;
        }

        .key-btn:hover {
            border-color: #4a90e2;
            transform: translateY(-1px);
        }

        .key-btn.active {
            background: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .chord-builder {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .roman-numerals {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .roman-btn {
            padding: 15px 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-weight: bold;
        }

        .roman-btn:hover {
            border-color: #28a745;
            transform: translateY(-1px);
        }

        .roman-btn.selected {
            background: #28a745;
            color: white;
            border-color: #28a745;
        }

        .progression-display {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            min-height: 60px;
            border: 2px dashed #dee2e6;
        }

        .progression-chord {
            display: inline-block;
            background: #4a90e2;
            color: white;
            padding: 8px 15px;
            margin: 5px;
            border-radius: 20px;
            font-weight: bold;
            position: relative;
            cursor: pointer;
        }

        .progression-chord .remove {
            margin-left: 8px;
            cursor: pointer;
            opacity: 0.7;
        }

        .progression-chord .remove:hover {
            opacity: 1;
        }

        .instrument-tabs {
            display: flex;
            margin-bottom: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 4px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .tab-btn.active {
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            color: #4a90e2;
        }

        .practice-area {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .metronome-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .tempo-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tempo-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: #4a90e2;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .tempo-btn:hover {
            background: #357abd;
            transform: scale(1.1);
        }

        .tempo-display {
            font-size: 1.2rem;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }

        .play-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            background: #28a745;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .play-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .play-btn.playing {
            background: #dc3545;
        }

        .keyboard-display {
            background: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .piano-keys {
            display: flex;
            justify-content: center;
            min-width: 600px;
        }

        .piano-key {
            position: relative;
            cursor: pointer;
            transition: all 0.1s ease;
        }

        .white-key {
            width: 45px;
            height: 140px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 0 0 6px 6px;
            margin-right: 2px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            padding-bottom: 10px;
            font-weight: bold;
            color: #666;
        }

        .black-key {
            width: 28px;
            height: 90px;
            background: #2c3e50;
            position: absolute;
            top: 0;
            z-index: 2;
            border-radius: 0 0 4px 4px;
            border: 1px solid #1a252f;
        }

        .piano-key.active {
            background: #ff6b6b !important;
            transform: scale(0.95);
        }

        .guitar-display {
            background: #8b4513;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
        }

        .fretboard {
            display: flex;
            min-width: 700px;
            height: 220px;
            position: relative;
        }

        .fret {
            flex: 1;
            border-right: 3px solid #654321;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            padding: 10px 0;
        }

        .fret:first-child {
            border-left: 4px solid #2c3e50;
        }

        .guitar-string {
            height: 2px;
            background: #c0c0c0;
            position: relative;
            margin: 15px 0;
        }

        .fret-marker {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ff6b6b;
            border-radius: 50%;
            border: 2px solid white;
            transform: translate(-50%, -50%);
            z-index: 3;
            top: 50%;
            left: 50%;
        }

        .chord-info-panel {
            background: #e8f4fd;
            border-left: 4px solid #4a90e2;
            padding: 20px;
            border-radius: 0 8px 8px 0;
            margin: 20px 0;
        }

        .chord-tones {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .chord-tone {
            background: #4a90e2;
            color: white;
            padding: 8px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .practice-modes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .mode-btn {
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }

        .mode-btn:hover {
            border-color: #4a90e2;
            transform: translateY(-2px);
        }

        .mode-btn.active {
            background: #4a90e2;
            color: white;
            border-color: #4a90e2;
        }

        .progress-indicator {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.3s ease;
        }

        .hidden {
            display: none;
        }

        .saved-progression {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .saved-progression:hover {
            border-color: #4a90e2;
            transform: translateY(-1px);
        }

        .saved-progression-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .saved-progression-chords {
            font-size: 0.8rem;
            color: #666;
        }

        .delete-saved {
            float: right;
            color: #dc3545;
            cursor: pointer;
            font-weight: bold;
        }

        .chord-analyzer {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }

        .scale-display {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .scale-note {
            background: #ffc107;
            color: #212529;
            padding: 6px 10px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 0.85rem;
        }

        .challenge-mode {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .challenge-timer {
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            margin: 15px 0;
        }

        .achievement-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin: 2px;
            font-weight: bold;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                border-right: none;
                border-bottom: 1px solid #e9ecef;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .workspace {
                padding: 20px;
            }
            
            .roman-numerals {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .key-selector {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎵 Chord Lab</h1>
            <p>Transform chord progressions into hands-on practice for piano and guitar</p>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <div class="section">
                    <h3>🎼 Choose Key</h3>
                    <div class="key-selector">
                        <button class="key-btn active" data-key="C">C Major</button>
                        <button class="key-btn" data-key="G">G Major</button>
                        <button class="key-btn" data-key="D">D Major</button>
                        <button class="key-btn" data-key="A">A Major</button>
                        <button class="key-btn" data-key="E">E Major</button>
                        <button class="key-btn" data-key="F">F Major</button>
                    </div>
                </div>

                <div class="section">
                    <h3>🏗️ Build Progression</h3>
                    <div class="chord-builder">
                        <div style="margin-bottom: 15px;">
                            <label style="font-weight: 600; margin-bottom: 8px; display: block;">Chord Quality:</label>
                            <select id="chordQuality" style="width: 100%; padding: 8px; border: 2px solid #e9ecef; border-radius: 6px; font-size: 0.9rem;">
                                <option value="basic">Basic Triads</option>
                                <option value="seventh">7th Chords</option>
                                <option value="extended">Extended Chords</option>
                            </select>
                        </div>
                        <div class="roman-numerals">
                            <button class="roman-btn" data-degree="I">I</button>
                            <button class="roman-btn" data-degree="ii">ii</button>
                            <button class="roman-btn" data-degree="iii">iii</button>
                            <button class="roman-btn" data-degree="IV">IV</button>
                            <button class="roman-btn" data-degree="V">V</button>
                            <button class="roman-btn" data-degree="vi">vi</button>
                        </div>
                        
                        <div class="progression-display" id="progressionDisplay">
                            <p style="color: #6c757d; text-align: center; margin-top: 15px;">Click roman numerals above to build your progression</p>
                        </div>
                        
                        <button class="play-btn" onclick="clearProgression()" style="background: #6c757d; width: 100%;">Clear All</button>
                    </div>
                </div>

                <div class="section">
                    <h3>🎯 Quick Progressions</h3>
                    <div style="margin-bottom: 15px;">
                        <label style="font-weight: 600; margin-bottom: 8px; display: block;">Difficulty:</label>
                        <select id="difficultyLevel" style="width: 100%; padding: 8px; border: 2px solid #e9ecef; border-radius: 6px; font-size: 0.9rem;">
                            <option value="beginner">🟢 Beginner</option>
                            <option value="intermediate">🟡 Intermediate</option>
                            <option value="advanced">🔴 Advanced</option>
                        </select>
                    </div>
                    <button class="mode-btn" onclick="loadProgression(['I', 'V', 'vi', 'IV'])">I-V-vi-IV</button>
                    <button class="mode-btn" onclick="loadProgression(['vi', 'IV', 'I', 'V'])">vi-IV-I-V</button>
                    <button class="mode-btn" onclick="loadProgression(['I', 'vi', 'ii', 'V'])">I-vi-ii-V</button>
                    <button class="mode-btn" onclick="loadProgression(['ii', 'V', 'I'])">ii-V-I Jazz</button>
                </div>

                <div class="section">
                    <h3>💾 Save & Load</h3>
                    <div style="margin-bottom: 15px;">
                        <input type="text" id="progressionName" placeholder="My Progression" style="width: 100%; padding: 8px; border: 2px solid #e9ecef; border-radius: 6px; margin-bottom: 10px;">
                        <button class="play-btn" onclick="saveProgression()" style="width: 100%; margin-bottom: 10px; font-size: 0.9rem;">💾 Save Current</button>
                    </div>
                    <div id="savedProgressions" style="max-height: 150px; overflow-y: auto;">
                        <!-- Saved progressions will appear here -->
                    </div>
                </div>
            </div>

            <div class="workspace">
                <div class="instrument-tabs">
                    <button class="tab-btn active" data-instrument="piano">🎹 Piano</button>
                    <button class="tab-btn" data-instrument="guitar">🎸 Guitar</button>
                </div>

                <div class="practice-area">
                    <div class="metronome-controls">
                        <div class="tempo-control">
                            <button class="tempo-btn" onclick="adjustTempo(-10)">-</button>
                            <div class="tempo-display" id="tempoDisplay">80</div>
                            <button class="tempo-btn" onclick="adjustTempo(10)">+</button>
                            <span style="margin-left: 10px;">BPM</span>
                        </div>
                        
                        <button class="play-btn" id="playBtn" onclick="togglePractice()">▶ Start Practice</button>
                        <button class="play-btn" id="challengeBtn" onclick="startChallenge()" style="background: #ff6b6b;">🏆 Challenge Mode</button>
                        
                        <div class="practice-modes">
                            <button class="mode-btn active" data-mode="block">Block Chords</button>
                            <button class="mode-btn" data-mode="arpeggio">Arpeggios</button>
                            <button class="mode-btn" data-mode="strum">Strumming</button>
                        </div>

                        <div style="margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            <label style="font-weight: 600; margin-bottom: 10px; display: block;">🔄 Chord Inversions (Piano):</label>
                            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                                <button class="mode-btn active" data-inversion="root">Root Position</button>
                                <button class="mode-btn" data-inversion="first">1st Inversion</button>
                                <button class="mode-btn" data-inversion="second">2nd Inversion</button>
                            </div>
                        </div>
                    </div>

                    <div class="challenge-mode hidden" id="challengeMode">
                        <h4>🏆 Challenge Mode: Speed Practice</h4>
                        <p>Play through your progression as fast as possible!</p>
                        <div class="challenge-timer" id="challengeTimer">0:00</div>
                        <div style="text-align: center;">
                            <button class="play-btn" onclick="stopChallenge()" style="background: #dc3545;">Stop Challenge</button>
                        </div>
                    </div>

                    <div id="pianoView">
                        <div class="keyboard-display">
                            <div class="piano-keys" id="pianoKeys">
                                <!-- Piano keys generated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div id="guitarView" class="hidden">
                        <div class="guitar-display">
                            <div class="fretboard" id="guitarFretboard">
                                <!-- Guitar fretboard generated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="chord-info-panel" id="chordInfo">
                        <h4>🎼 Current Chord: <span id="currentChordName">Select a progression</span></h4>
                        <p id="chordDescription">Build a chord progression to start practicing!</p>
                        <div class="chord-tones" id="chordTones">
                            <!-- Chord tones will be displayed here -->
                        </div>
                        <div id="songSuggestions" style="margin-top: 15px; display: none;">
                            <h5 style="color: #4a90e2; margin-bottom: 8px;">🎵 Songs using this progression:</h5>
                            <div id="songList" style="font-size: 0.9rem; color: #666;"></div>
                        </div>
                    </div>

                    <div class="chord-analyzer">
                        <h5 style="color: #856404; margin-bottom: 10px;">🔍 Music Theory Analysis</h5>
                        <div id="theoryAnalysis">Select a chord progression to see detailed analysis</div>
                        <div style="margin-top: 10px;">
                            <strong>Scale Notes:</strong>
                            <div class="scale-display" id="scaleDisplay">
                                <!-- Scale notes will appear here -->
                            </div>
                        </div>
                    </div>

                    <div class="progress-indicator">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span><strong>Practice Progress</strong></span>
                            <span id="progressText">0/0 chords</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>

                    <div class="practice-area" style="margin-top: 20px;">
                        <h4 style="margin-bottom: 15px;">📊 Practice Statistics & Achievements</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #28a745;" id="totalPracticeTime">0:00</div>
                                <div style="font-size: 0.9rem; color: #666;">Total Practice</div>
                            </div>
                            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #2196f3;" id="chordsPlayed">0</div>
                                <div style="font-size: 0.9rem; color: #666;">Chords Played</div>
                            </div>
                            <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #ff9800;" id="currentStreak">0</div>
                                <div style="font-size: 0.9rem; color: #666;">Current Streak</div>
                            </div>
                            <div style="background: #fce4ec; padding: 15px; border-radius: 8px; text-align: center;">
                                <div style="font-size: 1.5rem; font-weight: bold; color: #e91e63;" id="bestTime">--:--</div>
                                <div style="font-size: 0.9rem; color: #666;">Best Challenge</div>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h5 style="margin-bottom: 10px;">🏅 Achievements</h5>
                            <div id="achievementsList">
                                <!-- Achievements will appear here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Music theory data
        const keyData = {
            'C': { chords: ['C', 'Dm', 'Em', 'F', 'G', 'Am'], scale: ['C', 'D', 'E', 'F', 'G', 'A', 'B'] },
            'G': { chords: ['G', 'Am', 'Bm', 'C', 'D', 'Em'], scale: ['G', 'A', 'B', 'C', 'D', 'E', 'F#'] },
            'D': { chords: ['D', 'Em', 'F#m', 'G', 'A', 'Bm'], scale: ['D', 'E', 'F#', 'G', 'A', 'B', 'C#'] },
            'A': { chords: ['A', 'Bm', 'C#m', 'D', 'E', 'F#m'], scale: ['A', 'B', 'C#', 'D', 'E', 'F#', 'G#'] },
            'E': { chords: ['E', 'F#m', 'G#m', 'A', 'B', 'C#m'], scale: ['E', 'F#', 'G#', 'A', 'B', 'C#', 'D#'] },
            'F': { chords: ['F', 'Gm', 'Am', 'Bb', 'C', 'Dm'], scale: ['F', 'G', 'A', 'Bb', 'C', 'D', 'E'] }
        };

        const chordShapes = {
            piano: {
                'C': { 
                    root: ['C', 'E', 'G'], 
                    first: ['E', 'G', 'C'], 
                    second: ['G', 'C', 'E'],
                    seventh: ['C', 'E', 'G', 'B']
                },
                'Dm': { 
                    root: ['D', 'F', 'A'], 
                    first: ['F', 'A', 'D'], 
                    second: ['A', 'D', 'F'],
                    seventh: ['D', 'F', 'A', 'C']
                },
                'Em': { 
                    root: ['E', 'G', 'B'], 
                    first: ['G', 'B', 'E'], 
                    second: ['B', 'E', 'G'],
                    seventh: ['E', 'G', 'B', 'D']
                },
                'F': { 
                    root: ['F', 'A', 'C'], 
                    first: ['A', 'C', 'F'], 
                    second: ['C', 'F', 'A'],
                    seventh: ['F', 'A', 'C', 'E']
                },
                'G': { 
                    root: ['G', 'B', 'D'], 
                    first: ['B', 'D', 'G'], 
                    second: ['D', 'G', 'B'],
                    seventh: ['G', 'B', 'D', 'F#']
                },
                'Am': { 
                    root: ['A', 'C', 'E'], 
                    first: ['C', 'E', 'A'], 
                    second: ['E', 'A', 'C'],
                    seventh: ['A', 'C', 'E', 'G']
                },
                'D': { 
                    root: ['D', 'F#', 'A'], 
                    first: ['F#', 'A', 'D'], 
                    second: ['A', 'D', 'F#'],
                    seventh: ['D', 'F#', 'A', 'C#']
                },
                'Bm': { 
                    root: ['B', 'D', 'F#'], 
                    first: ['D', 'F#', 'B'], 
                    second: ['F#', 'B', 'D'],
                    seventh: ['B', 'D', 'F#', 'A']
                },
                'A': { 
                    root: ['A', 'C#', 'E'], 
                    first: ['C#', 'E', 'A'], 
                    second: ['E', 'A', 'C#'],
                    seventh: ['A', 'C#', 'E', 'G#']
                },
                'E': { 
                    root: ['E', 'G#', 'B'], 
                    first: ['G#', 'B', 'E'], 
                    second: ['B', 'E', 'G#'],
                    seventh: ['E', 'G#', 'B', 'D#']
                },
                'F#m': { 
                    root: ['F#', 'A', 'C#'], 
                    first: ['A', 'C#', 'F#'], 
                    second: ['C#', 'F#', 'A'],
                    seventh: ['F#', 'A', 'C#', 'E']
                },
                'C#m': { 
                    root: ['C#', 'E', 'G#'], 
                    first: ['E', 'G#', 'C#'], 
                    second: ['G#', 'C#', 'E'],
                    seventh: ['C#', 'E', 'G#', 'B']
                },
                'Bb': { 
                    root: ['Bb', 'D', 'F'], 
                    first: ['D', 'F', 'Bb'], 
                    second: ['F', 'Bb', 'D'],
                    seventh: ['Bb', 'D', 'F', 'A']
                },
                'Gm': { 
                    root: ['G', 'Bb', 'D'], 
                    first: ['Bb', 'D', 'G'], 
                    second: ['D', 'G', 'Bb'],
                    seventh: ['G', 'Bb', 'D', 'F']
                },
                'B': { 
                    root: ['B', 'D#', 'F#'], 
                    first: ['D#', 'F#', 'B'], 
                    second: ['F#', 'B', 'D#'],
                    seventh: ['B', 'D#', 'F#', 'A#']
                },
                'G#m': { 
                    root: ['G#', 'B', 'D#'], 
                    first: ['B', 'D#', 'G#'], 
                    second: ['D#', 'G#', 'B'],
                    seventh: ['G#', 'B', 'D#', 'F#']
                }
            },
            guitar: {
                'C': [0, 1, 0, 2, 1, 0], 'Dm': [0, 0, 0, 2, 3, 1], 'Em': [0, 2, 2, 0, 0, 0],
                'F': [1, 1, 3, 3, 2, 1], 'G': [3, 2, 0, 0, 3, 3], 'Am': [0, 0, 2, 2, 1, 0],
                'D': [0, 0, 0, 2, 3, 2], 'Bm': [2, 2, 4, 4, 3, 2], 'A': [0, 0, 2, 2, 2, 0],
                'E': [0, 2, 2, 1, 0, 0], 'F#m': [2, 4, 4, 2, 2, 2], 'C#m': [4, 4, 6, 6, 5, 4],
                'Bb': [1, 1, 3, 3, 3, 1], 'Gm': [3, 5, 5, 3, 3, 3], 'B': [2, 2, 4, 4, 4, 2],
                'G#m': [4, 6, 6, 4, 4, 4]
            }
        };

        // Song database for progression matching
        const songDatabase = {
            'I-V-vi-IV': ['Let It Be - Beatles', 'Don\'t Stop Believin\' - Journey', 'Someone Like You - Adele', 'With or Without You - U2'],
            'vi-IV-I-V': ['Despacito - Luis Fonsi', 'Counting Stars - OneRepublic', 'What\'s Up - 4 Non Blondes'],
            'I-vi-ii-V': ['Heart and Soul - Hoagy Carmichael', 'Blue Moon - Richard Rodgers', 'All of Me - John Legend'],
            'ii-V-I': ['Autumn Leaves - Jazz Standard', 'All The Things You Are - Jerome Kern', 'Fly Me to the Moon - Frank Sinatra'],
            'I-IV-V-I': ['Wild Thing - The Troggs', 'Louie Louie - The Kingsmen', 'Twist and Shout - The Beatles'],
            'vi-V-IV-V': ['Apologize - OneRepublic', 'Poker Face - Lady Gaga']
        };

        // App state
        let currentKey = 'C';
        let currentProgression = [];
        let currentInstrument = 'piano';
        let currentTempo = 80;
        let isPlaying = false;
        let currentChordIndex = 0;
        let practiceMode = 'block';
        let currentInversion = 'root';
        let currentChordQuality = 'basic';
        let practiceInterval;
        let practiceStartTime = null;
        let totalPracticeTime = 0;
        let chordsPlayedCount = 0;
        let currentStreak = 0;
        let bestChallengeTime = null;
        let challengeStartTime = null;
        let isChallengeMode = false;
        let savedProgressions = JSON.parse(localStorage.getItem('chordLabProgressions') || '[]');
        let achievements = JSON.parse(localStorage.getItem('chordLabAchievements') || '[]');

        // Initialize app
        function init() {
            createPianoKeys();
            createGuitarFretboard();
            setupEventListeners();
            updateChordDisplay();
            loadSavedProgressions();
            updateAchievements();
        }

        function setupEventListeners() {
            // Key selector
            document.querySelectorAll('.key-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.key-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentKey = e.target.dataset.key;
                    updateRomanNumerals();
                    updateChordDisplay();
                    updateTheoryAnalysis();
                });
            });

            // Roman numeral buttons
            document.querySelectorAll('.roman-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const degree = e.target.dataset.degree;
                    addToProgression(degree);
                });
            });

            // Instrument tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentInstrument = e.target.dataset.instrument;
                    switchInstrument();
                });
            });

            // Practice mode buttons
            document.querySelectorAll('[data-mode]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('[data-mode]').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    practiceMode = e.target.dataset.mode;
                });
            });

            // Inversion buttons
            document.querySelectorAll('[data-inversion]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('[data-inversion]').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentInversion = e.target.dataset.inversion;
                    updateChordDisplay();
                });
            });

            // Chord quality selector
            document.getElementById('chordQuality').addEventListener('change', (e) => {
                currentChordQuality = e.target.value;
                updateRomanNumerals();
                updateChordDisplay();
            });
        }

        function createPianoKeys() {
            const pianoKeys = document.getElementById('pianoKeys');
            const whiteKeys = ['C', 'D', 'E', 'F', 'G', 'A', 'B'];
            const blackKeys = ['C#', 'D#', null, 'F#', 'G#', 'A#', null];

            pianoKeys.innerHTML = '';

            whiteKeys.forEach((note, index) => {
                const keyContainer = document.createElement('div');
                keyContainer.style.position = 'relative';

                const whiteKey = document.createElement('div');
                whiteKey.className = 'piano-key white-key';
                whiteKey.dataset.note = note;
                whiteKey.textContent = note;

                if (blackKeys[index]) {
                    const blackKey = document.createElement('div');
                    blackKey.className = 'piano-key black-key';
                    blackKey.dataset.note = blackKeys[index];
                    blackKey.style.left = '32px';
                    keyContainer.appendChild(blackKey);
                }

                keyContainer.appendChild(whiteKey);
                pianoKeys.appendChild(keyContainer);
            });
        }

        function createGuitarFretboard() {
            const fretboard = document.getElementById('guitarFretboard');
            fretboard.innerHTML = '';

            for (let fret = 0; fret < 5; fret++) {
                const fretDiv = document.createElement('div');
                fretDiv.className = 'fret';
                fretDiv.dataset.fret = fret;

                for (let string = 0; string < 6; string++) {
                    const stringDiv = document.createElement('div');
                    stringDiv.className = 'guitar-string';
                    stringDiv.dataset.string = string;
                    fretDiv.appendChild(stringDiv);
                }

                fretboard.appendChild(fretDiv);
            }
        }

        function updateRomanNumerals() {
            const chords = keyData[currentKey].chords;
            const romanBtns = document.querySelectorAll('.roman-btn');
            
            romanBtns.forEach((btn, index) => {
                const chordName = chords[index];
                btn.innerHTML = `${btn.dataset.degree}<br><small>${chordName}</small>`;
            });
        }

        function addToProgression(degree) {
            const degreeIndex = ['I', 'ii', 'iii', 'IV', 'V', 'vi'].indexOf(degree);
            const chordName = keyData[currentKey].chords[degreeIndex];
            
            currentProgression.push({ degree, chord: chordName });
            updateProgressionDisplay();
            updateChordDisplay();
            updateTheoryAnalysis();
        }

        function updateProgressionDisplay() {
            const display = document.getElementById('progressionDisplay');
            
            if (currentProgression.length === 0) {
                display.innerHTML = '<p style="color: #6c757d; text-align: center; margin-top: 15px;">Click roman numerals above to build your progression</p>';
                return;
            }

            display.innerHTML = currentProgression.map((item, index) => 
                `<span class="progression-chord" onclick="removeFromProgression(${index})">
                    ${item.degree} (${item.chord})
                    <span class="remove">×</span>
                </span>`
            ).join('');
        }

        function removeFromProgression(index) {
            currentProgression.splice(index, 1);
            currentChordIndex = 0;
            updateProgressionDisplay();
            updateChordDisplay();
            updateProgress();
            updateTheoryAnalysis();
        }

        function clearProgression() {
            currentProgression = [];
            currentChordIndex = 0;
            updateProgressionDisplay();
            updateChordDisplay();
            updateProgress();
            updateTheoryAnalysis();
        }

        function loadProgression(degrees) {
            currentProgression = [];
            degrees.forEach(degree => addToProgression(degree));
        }

        function saveProgression() {
            if (currentProgression.length === 0) {
                alert('Please build a progression first!');
                return;
            }

            const name = document.getElementById('progressionName').value || 'Untitled Progression';
            const progression = {
                id: Date.now(),
                name: name,
                key: currentKey,
                chords: currentProgression.map(c => c.degree),
                created: new Date().toLocaleDateString()
            };

            savedProgressions.push(progression);
            localStorage.setItem('chordLabProgressions', JSON.stringify(savedProgressions));
            document.getElementById('progressionName').value = '';
            loadSavedProgressions();
            
            checkAchievement('first_save');
        }

        function loadSavedProgressions() {
            const container = document.getElementById('savedProgressions');
            
            if (savedProgressions.length === 0) {
                container.innerHTML = '<p style="color: #6c757d; font-size: 0.9rem; text-align: center;">No saved progressions yet</p>';
                return;
            }

            container.innerHTML = savedProgressions.map(prog => `
                <div class="saved-progression" onclick="loadSavedProgression(${prog.id})">
                    <div class="saved-progression-name">${prog.name}</div>
                    <div class="saved-progression-chords">${prog.key}: ${prog.chords.join('-')}</div>
                    <span class="delete-saved" onclick="event.stopPropagation(); deleteSavedProgression(${prog.id})">×</span>
                </div>
            `).join('');
        }

        function loadSavedProgression(id) {
            const prog = savedProgressions.find(p => p.id === id);
            if (!prog) return;

            // Set key
            currentKey = prog.key;
            document.querySelectorAll('.key-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.key === currentKey);
            });

            // Load progression
            currentProgression = [];
            prog.chords.forEach(degree => addToProgression(degree));
            updateRomanNumerals();
        }

        function deleteSavedProgression(id) {
            savedProgressions = savedProgressions.filter(p => p.id !== id);
            localStorage.setItem('chordLabProgressions', JSON.stringify(savedProgressions));
            loadSavedProgressions();
        }

        function switchInstrument() {
            const pianoView = document.getElementById('pianoView');
            const guitarView = document.getElementById('guitarView');
            
            if (currentInstrument === 'piano') {
                pianoView.classList.remove('hidden');
                guitarView.classList.add('hidden');
            } else {
                pianoView.classList.add('hidden');
                guitarView.classList.remove('hidden');
            }
            
            updateChordDisplay();
        }

        function updateChordDisplay() {
            clearHighlights();
            
            if (currentProgression.length === 0) {
                document.getElementById('currentChordName').textContent = 'Select a progression';
                document.getElementById('chordDescription').textContent = 'Build a chord progression to start practicing!';
                document.getElementById('chordTones').innerHTML = '';
                return;
            }

            const currentChord = currentProgression[currentChordIndex];
            document.getElementById('currentChordName').textContent = `${currentChord.degree} (${currentChord.chord})`;
            
            if (currentInstrument === 'piano') {
                showPianoChord(currentChord.chord);
                document.getElementById('chordDescription').textContent = `Play ${currentChord.chord} with right hand: root, third, fifth`;
            } else {
                showGuitarChord(currentChord.chord);
                document.getElementById('chordDescription').textContent = `Strum ${currentChord.chord} with proper fingering`;
            }

            showChordTones(currentChord.chord);
        }

        function showPianoChord(chordName) {
            const chordData = chordShapes.piano[chordName];
            if (!chordData) return;

            let notes;
            if (currentChordQuality === 'seventh') {
                notes = chordData.seventh || chordData.root;
            } else {
                notes = chordData[currentInversion] || chordData.root;
            }

            notes.forEach(note => {
                const key = document.querySelector(`[data-note="${note}"]`);
                if (key) {
                    key.classList.add('active');
                }
            });
        }

        function showGuitarChord(chordName) {
            const frets = chordShapes.guitar[chordName];
            if (!frets) return;

            frets.forEach((fretNum, stringIndex) => {
                if (fretNum > 0) {
                    const fretDiv = document.querySelector(`[data-fret="${fretNum}"]`);
                    if (fretDiv) {
                        const marker = document.createElement('div');
                        marker.className = 'fret-marker';
                        marker.style.top = `${20 + stringIndex * 30}px`;
                        fretDiv.appendChild(marker);
                    }
                }
            });
        }

        function showChordTones(chordName) {
            const chordData = chordShapes.piano[chordName];
            const tonesDiv = document.getElementById('chordTones');
            
            if (!chordData) {
                tonesDiv.innerHTML = '';
                return;
            }

            let notes;
            if (currentChordQuality === 'seventh') {
                notes = chordData.seventh || chordData.root;
            } else {
                notes = chordData[currentInversion] || chordData.root;
            }

            tonesDiv.innerHTML = notes.map(note => 
                `<span class="chord-tone">${note}</span>`
            ).join('');

            // Show song suggestions
            showSongSuggestions();
        }

        function showSongSuggestions() {
            const progressionString = currentProgression.map(item => item.degree).join('-');
            const songs = songDatabase[progressionString];
            const suggestionsDiv = document.getElementById('songSuggestions');
            const songListDiv = document.getElementById('songList');

            if (songs && songs.length > 0) {
                suggestionsDiv.style.display = 'block';
                songListDiv.innerHTML = songs.slice(0, 3).map(song => 
                    `<div style="margin: 3px 0;">• ${song}</div>`
                ).join('');
            } else {
                suggestionsDiv.style.display = 'none';
            }
        }

        function updateTheoryAnalysis() {
            const analysisDiv = document.getElementById('theoryAnalysis');
            const scaleDiv = document.getElementById('scaleDisplay');
            
            if (currentProgression.length === 0) {
                analysisDiv.textContent = 'Select a chord progression to see detailed analysis';
                scaleDiv.innerHTML = '';
                return;
            }

            const progressionString = currentProgression.map(item => item.degree).join('-');
            const scale = keyData[currentKey].scale;
            
            // Basic analysis
            let analysis = `Key: ${currentKey} Major | Progression: ${progressionString}`;
            
            // Add functional analysis
            if (progressionString.includes('V-I')) {
                analysis += ' | Contains authentic cadence (V-I)';
            }
            if (progressionString.includes('IV-I')) {
                analysis += ' | Contains plagal cadence (IV-I)';
            }
            if (progressionString === 'ii-V-I') {
                analysis += ' | Classic jazz turnaround';
            }

            analysisDiv.textContent = analysis;
            
            // Show scale
            scaleDiv.innerHTML = scale.map(note => 
                `<span class="scale-note">${note}</span>`
            ).join('');
        }

        function clearHighlights() {
            document.querySelectorAll('.piano-key').forEach(key => key.classList.remove('active'));
            document.querySelectorAll('.fret-marker').forEach(marker => marker.remove());
        }

        function adjustTempo(change) {
            currentTempo = Math.max(40, Math.min(200, currentTempo + change));
            document.getElementById('tempoDisplay').textContent = currentTempo;
        }

        function togglePractice() {
            if (currentProgression.length === 0) {
                alert('Please build a chord progression first!');
                return;
            }

            const playBtn = document.getElementById('playBtn');
            
            if (isPlaying) {
                stopPractice();
                playBtn.textContent = '▶ Start Practice';
                playBtn.classList.remove('playing');
            } else {
                startPractice();
                playBtn.textContent = '⏸ Stop Practice';
                playBtn.classList.add('playing');
            }
        }

        function startPractice() {
            isPlaying = true;
            currentChordIndex = 0;
            practiceStartTime = Date.now();
            updateChordDisplay();
            updateProgress();

            const interval = (60 / currentTempo) * 1000; // Convert BPM to milliseconds
            
            practiceInterval = setInterval(() => {
                currentChordIndex = (currentChordIndex + 1) % currentProgression.length;
                chordsPlayedCount++;
                currentStreak++;
                updateChordDisplay();
                updateProgress();
                updateStatistics();
                
                // Check achievements
                checkAchievement('practice_session');
                if (chordsPlayedCount >= 100) checkAchievement('chord_master');
                if (currentStreak >= 50) checkAchievement('streak_master');
                
                // Visual feedback
                flashChord();
            }, interval);
        }

        function stopPractice() {
            isPlaying = false;
            if (practiceInterval) {
                clearInterval(practiceInterval);
            }
            
            if (practiceStartTime) {
                totalPracticeTime += Date.now() - practiceStartTime;
                practiceStartTime = null;
                updateStatistics();
                
                // Check time-based achievements
                if (totalPracticeTime >= 300000) checkAchievement('dedicated_learner'); // 5 minutes
            }
        }

        function startChallenge() {
            if (currentProgression.length === 0) {
                alert('Please build a chord progression first!');
                return;
            }

            isChallengeMode = true;
            challengeStartTime = Date.now();
            currentChordIndex = 0;
            
            document.getElementById('challengeMode').classList.remove('hidden');
            updateChordDisplay();
            
            const challengeInterval = setInterval(() => {
                const elapsed = Date.now() - challengeStartTime;
                const minutes = Math.floor(elapsed / 60000);
                const seconds = Math.floor((elapsed % 60000) / 1000);
                document.getElementById('challengeTimer').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (!isChallengeMode) {
                    clearInterval(challengeInterval);
                }
            }, 100);
        }

        function stopChallenge() {
            if (!isChallengeMode) return;
            
            const challengeTime = Date.now() - challengeStartTime;
            isChallengeMode = false;
            
            document.getElementById('challengeMode').classList.add('hidden');
            
            // Update best time
            if (!bestChallengeTime || challengeTime < bestChallengeTime) {
                bestChallengeTime = challengeTime;
                const minutes = Math.floor(challengeTime / 60000);
                const seconds = Math.floor((challengeTime % 60000) / 1000);
                document.getElementById('bestTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                checkAchievement('speed_demon');
            }
        }

        function checkAchievement(type) {
            const achievementData = {
                'first_save': { name: 'First Save', desc: 'Saved your first progression' },
                'practice_session': { name: 'Practice Makes Perfect', desc: 'Completed a practice session' },
                'chord_master': { name: 'Chord Master', desc: 'Played 100+ chords' },
                'streak_master': { name: 'Streak Master', desc: 'Achieved 50+ chord streak' },
                'dedicated_learner': { name: 'Dedicated Learner', desc: 'Practiced for 5+ minutes' },
                'speed_demon': { name: 'Speed Demon', desc: 'Set a new challenge record' }
            };

            if (!achievements.includes(type) && achievementData[type]) {
                achievements.push(type);
                localStorage.setItem('chordLabAchievements', JSON.stringify(achievements));
                updateAchievements();
                
                // Show achievement notification
                setTimeout(() => {
                    alert(`🏅 Achievement Unlocked: ${achievementData[type].name}!`);
                }, 500);
            }
        }

        function updateAchievements() {
            const achievementsList = document.getElementById('achievementsList');
            
            const achievementData = {
                'first_save': { name: 'First Save', desc: 'Saved your first progression' },
                'practice_session': { name: 'Practice Makes Perfect', desc: 'Completed a practice session' },
                'chord_master': { name: 'Chord Master', desc: 'Played 100+ chords' },
                'streak_master': { name: 'Streak Master', desc: 'Achieved 50+ chord streak' },
                'dedicated_learner': { name: 'Dedicated Learner', desc: 'Practiced for 5+ minutes' },
                'speed_demon': { name: 'Speed Demon', desc: 'Set a new challenge record' }
            };

            if (achievements.length === 0) {
                achievementsList.innerHTML = '<p style="color: #6c757d; font-size: 0.9rem;">Complete practice sessions to unlock achievements!</p>';
                return;
            }

            achievementsList.innerHTML = achievements.map(achievement => {
                const data = achievementData[achievement];
                return `<span class="achievement-badge" title="${data.desc}">${data.name}</span>`;
            }).join('');
        }

        function updateStatistics() {
            // Update practice time
            let displayTime = totalPracticeTime;
            if (practiceStartTime) {
                displayTime += Date.now() - practiceStartTime;
            }
            
            const minutes = Math.floor(displayTime / 60000);
            const seconds = Math.floor((displayTime % 60000) / 1000);
            document.getElementById('totalPracticeTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            // Update other stats
            document.getElementById('chordsPlayed').textContent = chordsPlayedCount;
            document.getElementById('currentStreak').textContent = currentStreak;
            
            if (bestChallengeTime) {
                const minutes = Math.floor(bestChallengeTime / 60000);
                const seconds = Math.floor((bestChallengeTime % 60000) / 1000);
                document.getElementById('bestTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function flashChord() {
            const chordInfo = document.getElementById('chordInfo');
            chordInfo.style.background = '#d4edda';
            setTimeout(() => {
                chordInfo.style.background = '#e8f4fd';
            }, 200);
        }

        function updateProgress() {
            const progressText = document.getElementById('progressText');
            const progressFill = document.getElementById('progressFill');
            
            if (currentProgression.length === 0) {
                progressText.textContent = '0/0 chords';
                progressFill.style.width = '0%';
                return;
            }

            const progress = ((currentChordIndex + 1) / currentProgression.length) * 100;
            progressText.textContent = `${currentChordIndex + 1}/${currentProgression.length} chords`;
            progressFill.style.width = `${progress}%`;
        }

        // Initialize app when page loads
        init();
        updateRomanNumerals();
        updateTheoryAnalysis();
        
        // Update statistics display every second
        setInterval(updateStatistics, 1000);
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'973ff197f39429a1',t:'MTc1NjAwODAzNy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
